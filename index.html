<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>Deepl.io</title>
		<link rel="shortcut icon" type="image/ico" href="/admin/assets/img/favicon.ico">
		<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
		<style type="text/css" media="screen">
			h1 { color: #555; }
			h1 span { font-size: 0.6em; color: #999; }
			body { color: #666; }
		</style>
	</head>
	<body>

		<header class="navbar navbar-default" role="banner">
			<div class="container">
				<div class="navbar-header">
					<a href="http://deepl.io" class="navbar-brand">Git deployment simplified.</a>
				</div>
				<nav class="collapse navbar-collapse" role="navigation">
					<!--<ul class="nav navbar-nav">
						<li>
							<a href="/admin/">Overview</a>
						</li>
					</ul>-->
				</nav>
			</div>
		</header>

		<div class="container">
			<h1>Deepl.io</h1>
			<div class="row">
				<div class="col-md-12">
					<p class="lead">A simple yet powerful php-tool to catch GIT Web-Hooks and deploy your projects to your server after pushing.</p>
					<p>
						<a href="https://github.com/noelboss/deepl.io" class="btn btn-info" name="deploy<?= $i ?>">Visit Github</a>
						<a href="https://github.com/noelboss/deepl.io/archive/master.zip" class="btn btn-success" name="deploy<?= $i ?>">Download Latest</a>
					</p>

					<hr/>
					<h2>How does it work?</h2>
					<p>
						Deepl.io catches and acts on requests sent by your git service-provider using <a href="https://developer.github.com/v3/repos/hooks/">web-hooks</a>. Currently <a href="http://doc.gitlab.com/ee/web_hooks/web_hooks.html">github.com</a> and <a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/web_hooks/web_hooks.md">gitlab.com</a> are supported.
						You configure your repository to send push-updates to your Deepl.io instance. Check your repository setting for the appropriate option.
						Deepl.io will check weather the request comes from the right source, detects if the branch that you pushed to is correct and then
						executes your php or shell commands.
					</p>

					<hr/>
					<h2>Installation</h2>
					<p>
						<a href="https://github.com/noelboss/deepl.io/archive/master.zip">Download</a> Deepl.io to your server or <a href="https://github.com/noelboss/deepl.io">clone using git</a>. Consider creating a subdomain:
						<code>deploy.yourserver.com</code>.
					</p>
					<p>
						<strong>Requirements:</strong>
						PHP, and your web-host needs to allow <a href="http://php.net/manual/en/function.exec.php">php exec</a> commands and <code>mod_rewrite</code> has to be enabled.
					</p>

					<hr/>
					<h2>Setup</h2>
					<p>
						Open <code>config/config.example.json</code> and rename it to <code>config.json</code>.
						Set a secret token and maybe configure allowed ips.
						<br/>
						Then, add this to the Web-Hook Settings of your GIT Provider:
						<code>deploy.yourserver.com/your-secret-token</code>
					</p>

					<hr/>
					<h2>Configure Deployments</h2>
					<p>
						Right now, you need to configure your deploys manually. It's pretty simple:
						open the <code>repositories/</code> folder, create a new folder corresponding with your git-repository-name and add 3 files:<br />
						<code>your-repo.git</code>/<code>branch.config.json</code> containing information (name, repository-ssh-url, branch) required to identify your deployment<br/>
						<code>your-repo.git</code>/<code>branch.script.php / .sh</code> contains the code that should be executed when the hook is called. PHP scripts take precedence over shell scripts since they can call it themselfs.<br />
						<code>your-repo.git</code>/<code>branch.request.json</code> (optional) containing a test JSON payload<br />
						The <code>branch.</code> part is needed to distinguish push events only for the desired branch.
					</p>
					<p>
						<strong>Example Structure:</strong><br/>
						<code>deepl.io.git</code>/<code>master.config.json</code><br/>
						<code>deepl.io.git</code>/<code>master.script.sh</code><br />
						<code>deepl.io.git</code>/<code>master.request.json</code><br />
					</p>

					<hr/>
					<h4>Example Configureation JSON</h4>
					<pre>
{
	"project": {
		"name": "Example Project",
		"repository_ssh_url": "git@example.com:mike/example.git",
		"branch": "deploy/test"
	},
	"notification": {
		"mail": "me@noelboss.com"
	}
}</pre>
					<p>
						It is important, that the "repository_ssh_url" matches the repository that your service provider
						delivers using the JOSN Payload. You can test this by calling <a href="/admin/">/admin/</a> (protected by .htaccess, only works localy) and updating the example request <code>branch.request.json</code>:
					</p>
					<strong><a href="https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/web_hooks/web_hooks.md">Gitlab JSON</a>:</Strong><pre>
...
	"repository": {
		...
		"git_ssh_url":"git@example.com:mike/example.git",
		...
	},
...</pre>
					<strong><a href="http://doc.gitlab.com/ee/web_hooks/web_hooks.html">Github JSON</a>:</Strong><pre>
...
	"repository": {
		...
		"ssh_url": "git@github.com:mike/example.git",
		...
	},
...</pre>


					<hr/>
					<h2>Debugging &amp; Issues</h2>
					<p>
						Check <code>logs/deeplio.log</code> if you have any problems or open up
						an <a href="https://github.com/noelboss/deepl.io/issues">issue</a>.
					</p>
				</div>
			</div>

			<footer class="text-right">
				<p><copy>© <a href="//noelboss.com">Noël Bossart</a>. Made in Switzerland.</copy></p>
			</footer>
		</div>
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-5342062-8', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>